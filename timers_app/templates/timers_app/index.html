<!DOCTYPE html>
{% load format_tags %}
{% load static %}
<html>
<head>
    <title>Timers</title>
    <link rel="icon" type="image/x-icon" href="{% static 'timers_app/img/favicon.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'timers_app/css/drag.css' %}">
</head>
<body class="container py-4">
    <h1>Timers</h1>
    <form method="POST">{% csrf_token %}
        <button name="action" value="add" class="btn btn-primary mb-3" style="font-weight: bold;">â• Add Timer</button>
    </form>
    <div id="timer-container" ondrop="drop(event)">
    {% for timer in timers %}
        <div class="card mb-2 p-3 {% if timer.running %}bg-warning-subtle{% endif %}" ondragstart="drag(event)" ondragend="dragEnd(event)" ondragover="allowDrop(event)" ondrop="drop(event)" id="timer-{{ forloop.counter0 }}">
            <form method="POST" class="d-flex align-items-center justify-content-between gap-2">{% csrf_token %}
                <div class="d-flex align-items-center gap-2">
                    <span class="drag-handle" title="Drag to reorder">â˜°</span>
                    <button type="submit" name="action" value="update" class="btn btn-info" {% if timer.locked %}disabled{% endif %}>ğŸ’¾</button>
                    <textarea name="name" class="form-control me-2" rows="1" style="width: 400px;" {% if timer.locked %}disabled{% endif %}>{{ timer.name }}</textarea>
                    {% if timer.running %}
                    <span class="me-2" style="width: 90px; font-weight: 500; text-align: center;" data-timer
                          data-start="{{ timer.start_time }}"
                          data-elapsed="{{ timer.elapsed }}">
                        {{ timer.elapsed_display|format_minutes }} min
                    </span>
                    {% else %}
                    <input type="number" name="elapsed" class="form-control me-2 elapsed-input" {% if timer.locked %}disabled{% endif %}
                           step="0.1" min="0" style="width: 90px; font-weight: 500"
                           value="{% if timer.elapsed_display %}{{ timer.elapsed_display|format_minutes }}{% else %}0.0{% endif %}">
                    <span data-timer data-elapsed="{{ timer.elapsed }}" style="display: none;"></span>
                    {% endif %}
                    {% if timer.running %}
                    <button type="submit" name="action" value="toggle" class="btn btn-warning me-2" style="width: 100px; font-weight: 500;" {% if timer.locked %}disabled{% endif %}>â¸ Pause</button>
                    {% else %}
                    <button type="submit" name="action" value="toggle" class="btn btn-success me-2" style="width: 100px; font-weight: 500;" {% if timer.locked %}disabled{% endif %}>â–¶ï¸ Start</button>
                    {% endif %}
                    <button type="submit" name="action" value="delete" class="btn btn-danger" {% if timer.locked %}disabled{% endif %}>ğŸ—‘ï¸</button>
                </div>
                <button type="submit" name="action" value="lock" class="btn {% if timer.locked %}btn-secondary{% else %}btn-outline-secondary{% endif %}">
                    {% if timer.locked %}ğŸ”“{% else %}ğŸ”’{% endif %}
                </button>
                <input type="hidden" name="timer_id" value="{{ forloop.counter0 }}">
            </form>
        </div>
    {% endfor %}
    <div class="text-end fw-bold mt-3">
        Total time:
        <span id="total-minutes">{{ total_minutes|floatformat:0 }}</span> min /
        <span id="total-hours">{{ total_hours_formatted }}</span>
    </div>
    </div>

    <footer class="fixed-bottom text-center py-2 bg-light border-top shadow-sm">
        <a href="https://github.com/watista/dynamic-timers" target="_blank" class="text-dark text-decoration-none fw-semibold"><img src="{% static 'timers_app/img/github.png' %}" alt="GitHub" width="20" height="20"> View on <span class="text-secondary">GitHub</span></a>
    </footer>

    <div id="js-context"
         data-csrf-token="{{ csrf_token }}"
         data-reorder-url="{% url 'index' %}">
    </div>
    <script src="{% static 'timers_app/js/drag.js' %}"></script>
</body>
</html>
